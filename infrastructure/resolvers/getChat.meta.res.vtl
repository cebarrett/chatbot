#if($util.isNull($ctx.result))
  $util.error("Chat not found", "NOT_FOUND")
#end

## Authorization check: compare current user's Clerk ID with stored clerkId
## Note: clerkId is stored in chat metadata for VTL auth checks
## The internalUserId is used for data organization (USER# partition keys)
#if($ctx.result.clerkId != $context.identity.sub)
  $util.unauthorized()
#end

## Store metadata in stash for the next function
$util.qr($ctx.stash.put("chatMeta", $ctx.result))
{}
